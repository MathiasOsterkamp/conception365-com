<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Mathias Osterkamp"><meta property="og:type" content="article"><meta property="og:image" content="/post/2021-08-13-spfx-2019-pnpm/header_hucad760f47b2bf2a2bf8c8cbc7d6484e3_1088333_350x0_resize_q75_box.jpg"><meta property="twitter:image" content="/post/2021-08-13-spfx-2019-pnpm/header_hucad760f47b2bf2a2bf8c8cbc7d6484e3_1088333_350x0_resize_q75_box.jpg"><meta name=title content="SPFX 2019 - speed up npm performance"><meta property="og:title" content="SPFX 2019 - speed up npm performance"><meta property="twitter:title" content="SPFX 2019 - speed up npm performance"><meta name=description content><meta property="og:description" content><meta property="twitter:description" content><meta property="twitter:card" content="summary"><meta name=keyword content="SharePoint, Microsoft, Office 365, Teams, Azure, Webdevelopment"><link rel="shortcut icon" href=/%20img/favicon.ico><title>SPFX 2019 - speed up npm performance-Mathias Osterkamp</title><link rel=canonical href=/post/2021-08-13-spfx-2019-pnpm/><link rel=preload href=fonts/jost/files/jost-latin-200-normal.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=fonts/jost/files/jost-latin-400-normal.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=fonts/jost/files/jost-latin-500-normal.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://conception365.com/main.min.1e980d9d3ce924e51355893d3ecd38de2305a5ab49e1d43e9dd3e12976b10d3d.css><script type=text/javascript src=/js/bundle.min.cf130d59a45ea9a2c62f72ae45d7f5f2ce1fbdd107553920f51a2fdce3bdd822.js defer></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JG6K5XRGQL"></script><script>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-JG6K5XRGQL',{anonymize_ip:!0})}</script><script async src=http://localhost:3000/tracker.js data-ackee-server=http://localhost:3000 data-ackee-opts='{ "ignoreLocalhost": false,"ignoreOwnVisits": false, "detailed": true }' data-ackee-domain-id=8d8a9a93-b756-432f-b199-8df069f35faf></script></head><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=site-heading><a href=https://conception365.com><h1>Mathias Osterkamp</h1></a><span class=subheading>Specialist – focus development Microsoft technology stack</span></div></div></div></div></header><nav class="navbar navbar-default navbar-custom"><div class=container><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav"><li><a href=/>Home</a></li><li><a href=/categories/administration>administration</a></li><li><a href=/categories/powerapps>powerapps</a></li><li><a href=/categories/spfx>spfx</a></li><li><a href=/top/about/>ABOUT ME</a></li></ul><ul class="nav navbar-nav navbar-right"><li><a href=/search>SEARCH <img src=/img/search.png height=15 style=cursor:pointer alt=Search></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector('.navbar-toggle'),$navbar=document.querySelector('#huxblog_navbar'),$collapse=document.querySelector('.navbar-collapse');$toggle.addEventListener('click',handleMagic);function handleMagic(a){$navbar.className.indexOf('in')>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf('in')<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><article><div class=container><div class=row><div class="col-lg-8
col-md-8
post-container"><div class=post-preview><div class=penci-standard-cat><span class=cat><a class=penci-cat-name href=https://conception365.com/tags/sharepoint/ rel="category tag">SharePoint</a>
<a class=penci-cat-name href=https://conception365.com/tags/sp2019/ rel="category tag">SP2019</a>
<a class=penci-cat-name href=https://conception365.com/tags/pnpm/ rel="category tag">pnpm</a></span></div><a href=https://conception365.com/post/2021-08-13-spfx-2019-pnpm/><h2 class=post-title>SPFX 2019 - speed up npm performance</h2></a><h2 class=post-subtitle>How you can get rid of the slow npm installation</h2><span class=post-meta>Written by
Mathias Osterkamp
on
Friday, August 13, 2021</span>
<a href=header.jpg target=_blank><img src=/post/2021-08-13-spfx-2019-pnpm/header_hucad760f47b2bf2a2bf8c8cbc7d6484e3_1088333_800x0_resize_q75_box.jpg></a></div><h1 id=problem>Problem</h1><p>For current sharepoint projects we have huge node_modules folders. With every new project we have to download everything again. I started to look for a better solution and found <strong>pnpm</strong>.</p><h1 id=solution>Solution</h1><p><a href=https://pnpm.io/><strong>pnpm</strong></a> is a complete custom package manager designed for better performance, but compatible with npm. Instead of heaving multiple packages it uses symlinks and reuses packages. They published a speed comparison, in some tests it is pretty fast, especial if you already have some projects.</p><p><a href=pnpm-performance.png target=_blank><img src=pnpm-performance.png alt=Performance loading=lazy></a></p><p>So next steps are to prepare our existing solution for showcase.</p><h2 id=cleanup-old-node_modules>Cleanup old node_modules</h2><p>Fastest way to cleanup your node_modules folder is via npm rimraf. Install this global:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd>npm install rimraf -g
</code></pre></div><p>Now you can easy clean your folder:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd>PS C:\daten\git\spfx-2019-solution\spfx-2019&gt; rimraf node_modules
</code></pre></div><h2 id=install-pnpm>Install pnpm</h2><p>With npm we install a global version of pnpm. We need version 5 because we have node v12 for our sharepoint 2019 projects.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd>npm i pnpm@5.18.9 -g
</code></pre></div><p>Next step is to give pnpm a better storage folder. Edit your npm config.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd>npm config edit
</code></pre></div><p>You can set your folder here:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>store-dir=C:\Daten\pnpm\store
optional=false
</code></pre></div><p>No we reinstall our packages with pnpm. We use the &ndash;shamefully-hoist because we need to recover our structure.</p><blockquote><p>By default, pnpm creates a semistrict node_modules, meaning dependencies have access to undeclared dependencies but modules outside of node_modules do not. With this layout, most of the packages in the ecosystem work with no issues. However, if some tooling only works when the hoisted dependencies are in the root of node_modules, you can set this to true to hoist them for you.</p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd>PS C:\daten\git\spfx-2019-solution\spfx-2019&gt; pnpm install --shamefully-hoist
 WARN  @microsoft/sp-build-web &gt; @microsoft/sp-build-common &gt; @microsoft/sp-tslint-rules: tslint-microsoft-contrib@5.0.3 requires a peer of typescript@<span style=color:#f1fa8c>^2</span>.1.0 but version 3.6.4 was installed.pt/3.6.4: 6.22 MB/8.2 MB
Packages: +1580
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++  
Packages are hard linked from the content-addressable store to the virtual store.
  Content-addressable store is at: C:\daten\pnpm\store\v3
  Virtual store is at:             node_modules/.pnpm
Downloading registry.npmjs.org/typescript/3.6.4: 8.2 MB/8.2 MB, done
Downloading registry.npmjs.org/office-ui-fabric-react/5.21.0: 7.33 MB/7.33 MB, done
Progress: resolved 1599, reused 0, downloaded 1599, added 1580, done
 WARN  Failed to find <span style=color:#f1fa8c>&#34;/watchpack-chokidar2/2.0.1&#34;</span> in lockfile during hoisting. Next aliases will not be hoisted: watchpack-chokidar2
 WARN  Failed to find <span style=color:#f1fa8c>&#34;/fsevents/1.2.13&#34;</span> in lockfile during hoisting. Next aliases will not be hoisted: fsevents
 WARN  Failed to find <span style=color:#f1fa8c>&#34;/uglify-to-browserify/1.0.2&#34;</span> in lockfile during hoisting. Next aliases will not be hoisted: uglify-to-browserify
node_modules/.pnpm/deasync@0.1.22/node_modules/deasync: Running install script, done in 1.7s
node_modules/.pnpm/core-js@2.6.12/node_modules/core-js: Running postinstall script, done in 876ms
node_modules/.pnpm/ejs@2.7.4/node_modules/ejs: Running postinstall script, done in 912ms
node_modules/.pnpm/@microsoft/sp-loader@1.4.1/node_modules/@microsoft/sp-loader: Running install script, done in 1s
node_modules/.pnpm/node-sass@4.14.1/node_modules/node-sass: Running install script, done in 2.4s
node_modules/.pnpm/spawn-sync@1.0.15/node_modules/spawn-sync: Running postinstall script, done in 811ms
node_modules/.pnpm/phantomjs-prebuilt@2.1.16/node_modules/phantomjs-prebuilt: Running install script, done in 6.9s
node_modules/.pnpm/node-sass@4.14.1/node_modules/node-sass: Running postinstall script, done in 1.9s
node_modules/.pnpm/uglifyjs-webpack-plugin@0.4.6_webpack@3.6.0/node_modules/uglifyjs-webpack-plugin: Running postinstall script, done in 322ms
Cannot link binary &#39;jest&#39; of &#39;jest-cli&#39; to &#39;C:\daten\git\spfx-2019-solution\spfx-2019\node_modules\.pnpm\@microsoft\gulp-core-build@3.2.7\node_modules\@microsoft\gulp-core-build\node_modules\.bin&#39;: binary of &#39;jest&#39; is already linked

dependencies:
+ @custom/spfx-2019-lib 1.0.0 &lt;- ..\spfx-2019-lib
+ @microsoft/decorators 1.4.1 (1.12.1 is available)
+ @microsoft/sp-application-base 1.4.1 (1.12.1 is available)
+ @microsoft/sp-core-library 1.4.1 (1.12.1 is available)
+ @microsoft/sp-dialog 1.4.1 (1.12.1 is available)
+ @microsoft/sp-lodash-subset 1.4.1 (1.12.1 is available)
+ @microsoft/sp-office-ui-fabric-core 1.4.1 (1.12.1 is available)
+ @microsoft/sp-webpart-base 1.4.1 (1.12.1 is available)
+ react 15.6.2 (17.0.2 is available)
+ react-dom 15.6.2 (17.0.2 is available)

devDependencies:
+ @microsoft/generator-sharepoint 1.9.1 (1.12.1 is available)
+ @microsoft/sp-build-web 1.4.1 (1.12.1 is available)
+ @microsoft/sp-module-interfaces 1.4.1 (1.12.1 is available)
+ @microsoft/sp-webpart-workbench 1.4.1 (1.12.1 is available)
+ @types/es6-promise 0.0.33 (3.3.0 is available)
+ @types/microsoft-ajax 0.0.33 (0.0.37 is available)
+ @types/react 15.6.6 (17.0.17 is available)
+ @types/react-dom 15.5.6 (17.0.9 is available)
+ @types/sharepoint 2016.1.2 (2016.1.10 is available)
+ ajv 5.2.5 (8.6.2 is available)
+ gulp 3.9.1 (4.0.2 is available)
+ typescript 3.6.4 (4.3.5 is available)
</code></pre></div><p>Thats all! We can add finally a preinstall to our <em>package.json</em> to prevent from using npm again.</p><p>&ldquo;preinstall&rdquo;: &ldquo;npx only-allow pnpm&rdquo;</p><h2 id=bonus-create-spfx-packages>Bonus create spfx packages</h2><p>Our yeoman generator for sharepoint also supports this package manager:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd>yo @microsoft/sharepoint --package-manager pnpm

</code></pre></div><div class=post-author><div class=author-img><img alt="Mathias Osterkamp" src=https://conception365.com/img/mathiasosterkamp_half.png class="avatar avatar-100 photo" height=100 width=100></div><div class=author-content><h5><a href=/top/about/ title="Written by Mathias Osterkamp" rel=author>Mathias Osterkamp</a></h5><p>I've been working for about 12 years with a thematic focus on 'Collaboration' and 'Digital Transformation' especially in the product environment Microsoft on the topics Office 365, SharePoint, Azure and general web development.</p></div></div><ul class=pager><li class=previous><a href=https://conception365.com/post/2021-07-23-spse-first-review/ data-toggle=tooltip data-placement=top title="SharePoint Server Subscription Edition - First Review">&larr;
Previous Post<div class=pager-title>SharePoint Server Subscription Edition - First Review</div></a></li><li class=next><a href=https://conception365.com/post/2021-08-31-spfx-showcase-mysite/ data-toggle=tooltip data-placement=top title="SPFX Showcase - MySite">Next
Post &rarr;<div class=pager-title>SPFX Showcase - MySite</div></a></li></ul><br></div><div class="col-lg-4
col-md-4
sidebar-container"><h5>TOC</h5><nav id=TableOfContents><ul><li><a href=#problem>Problem</a></li><li><a href=#solution>Solution</a><ul><li><a href=#cleanup-old-node_modules>Cleanup old node_modules</a></li><li><a href=#install-pnpm>Install pnpm</a></li><li><a href=#bonus-create-spfx-packages>Bonus create spfx packages</a></li></ul></li></ul></nav><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/tags/managed-metadata title=managed-metadata>managed-metadata</a>
<a href=/tags/onpremise title=onpremise>onpremise</a>
<a href=/tags/pnp title=pnp>pnp</a>
<a href=/tags/powerapps title=powerapps>powerapps</a>
<a href=/tags/powershell title=powershell>powershell</a>
<a href=/tags/sevdesk title=sevdesk>sevdesk</a>
<a href=/tags/sharepoint title=sharepoint>sharepoint</a>
<a href=/tags/sp2019 title=sp2019>sp2019</a>
<a href=/tags/spfx title=spfx>spfx</a></div></section><section><hr><h5>RECENT POSTS</h5><ul class=side-newsfeed><li class=penci-feed><div class=side-item><div class=side-image><a class="penci-image-holder penci-lazy small-fix-size" rel=bookmark href=https://conception365.com/post/2024-01-28-pnp-powwershell-2019-onpremise-docs/ title="PnP Powershell 2019 Documentation" style=display:inline-block;background-image:url(/post/2024-01-28-pnp-powwershell-2019-onpremise-docs/header_hub75b70aca03219830cc5b11ef9adcf02_2046261_120x0_resize_box_2.png)></a></div><div class=side-item-text><h4 class=side-title-post><a href=https://conception365.com/post/2024-01-28-pnp-powwershell-2019-onpremise-docs/ rel=bookmark title="PnP Powershell 2019 Documentation">PnP Powershell 2019 Documentation</a></h4><span class=side-item-meta><time class="entry-date published">Sunday, January 28, 2024</time></span></div></div></li><li class=penci-feed><div class=side-item><div class=side-image><a class="penci-image-holder penci-lazy small-fix-size" rel=bookmark href=https://conception365.com/post/2022-01-30-mysite-redirect-links/ title="Mysite - Redirects" style=display:inline-block;background-image:url(/post/2022-01-30-mysite-redirect-links/header_hu1fc9044e0354cb91afb2b35d3c05b456_3585475_120x0_resize_box_2.png)></a></div><div class=side-item-text><h4 class=side-title-post><a href=https://conception365.com/post/2022-01-30-mysite-redirect-links/ rel=bookmark title="Mysite - Redirects">Mysite - Redirects</a></h4><span class=side-item-meta><time class="entry-date published">Sunday, January 30, 2022</time></span></div></div></li><li class=penci-feed><div class=side-item><div class=side-image><a class="penci-image-holder penci-lazy small-fix-size" rel=bookmark href=https://conception365.com/post/2021-11-01-powershell-create-navigation/ title="Powershell - Create Navigation" style=display:inline-block;background-image:url(/post/2021-11-01-powershell-create-navigation/header_hu57fad8182e36ba611e1f4a15b5e0c725_73932_120x0_resize_box_2.png)></a></div><div class=side-item-text><h4 class=side-title-post><a href=https://conception365.com/post/2021-11-01-powershell-create-navigation/ rel=bookmark title="Powershell - Create Navigation">Powershell - Create Navigation</a></h4><span class=side-item-meta><time class="entry-date published">Monday, November 1, 2021</time></span></div></div></li><li class=penci-feed><div class=side-item><div class=side-image><a class="penci-image-holder penci-lazy small-fix-size" rel=bookmark href=https://conception365.com/post/2021-10-22-jsom-termgroup-add-contributor/ title="Site termgroup add contributor or manager" style=display:inline-block;background-image:url(/post/2021-10-22-jsom-termgroup-add-contributor/header_huf4a0530713166702484ca9ce582083fb_54113_120x0_resize_box_2.png)></a></div><div class=side-item-text><h4 class=side-title-post><a href=https://conception365.com/post/2021-10-22-jsom-termgroup-add-contributor/ rel=bookmark title="Site termgroup add contributor or manager">Site termgroup add contributor or manager</a></h4><span class=side-item-meta><time class="entry-date published">Friday, October 22, 2021</time></span></div></div></li><li class=penci-feed><div class=side-item><div class=side-image><a class="penci-image-holder penci-lazy small-fix-size" rel=bookmark href=https://conception365.com/post/2021-08-31-spfx-showcase-mysite/ title="SPFX Showcase - MySite" style=display:inline-block;background-image:url(/post/2021-08-31-spfx-showcase-mysite/header_hu08cc3da8430171f206449dcc5b7e02bb_59082_120x0_resize_box_2.png)></a></div><div class=side-item-text><h4 class=side-title-post><a href=https://conception365.com/post/2021-08-31-spfx-showcase-mysite/ rel=bookmark title="SPFX Showcase - MySite">SPFX Showcase - MySite</a></h4><span class=side-item-meta><time class="entry-date published">Tuesday, August 31, 2021</time></span></div></div></li></ul></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href rel=alternate type=application/rss+xml title="Mathias Osterkamp"><span class=fa-stack><i class="fas fa-rss"></i></span>
RSS</a></li><li><a href=mailto:mathias.osterkamp@conception365.com><span class=fa-stack><i class="fas fa-envelope"></i></span>
Email</a></li><li><a href=/top/impressum/><span>Impressum</span></a></li><li><a href=/top/privacy/><span>Privacy Policy</span></a></li></ul><p class="copyright text-muted">Copyright &copy; Mathias Osterkamp 2024</p></div></div></div></footer></body></html>