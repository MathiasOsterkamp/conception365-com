<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Mathias Osterkamp"><meta property="og:type" content="article"><meta property="og:image" content="/post/2021-03-20-spfx-2019-libraries/header_hubc7cee928acac53d27edaf34292d924f_5022175_350x0_resize_q75_box.jpg"><meta property="twitter:image" content="/post/2021-03-20-spfx-2019-libraries/header_hubc7cee928acac53d27edaf34292d924f_5022175_350x0_resize_q75_box.jpg"><meta name=title content="SPFX 2019 Libraries with PnP JS"><meta property="og:title" content="SPFX 2019 Libraries with PnP JS"><meta property="twitter:title" content="SPFX 2019 Libraries with PnP JS"><meta name=description content><meta property="og:description" content><meta property="twitter:description" content><meta property="twitter:card" content="summary"><meta name=keyword content="SharePoint, Microsoft, Office 365, Teams, Azure, Webdevelopment"><link rel="shortcut icon" href=/%20img/favicon.ico><title>SPFX 2019 Libraries with PnP JS-Mathias Osterkamp</title><link rel=canonical href=/post/2021-03-20-spfx-2019-libraries/><link rel=preload href=fonts/jost/files/jost-latin-200-normal.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=fonts/jost/files/jost-latin-400-normal.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=fonts/jost/files/jost-latin-500-normal.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://conception365.com/main.min.1e980d9d3ce924e51355893d3ecd38de2305a5ab49e1d43e9dd3e12976b10d3d.css><script type=text/javascript src=/js/bundle.min.cf130d59a45ea9a2c62f72ae45d7f5f2ce1fbdd107553920f51a2fdce3bdd822.js defer></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JG6K5XRGQL"></script><script>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-JG6K5XRGQL',{anonymize_ip:!0})}</script><script async src=http://localhost:3000/tracker.js data-ackee-server=http://localhost:3000 data-ackee-opts='{ "ignoreLocalhost": false,"ignoreOwnVisits": false, "detailed": true }' data-ackee-domain-id=8d8a9a93-b756-432f-b199-8df069f35faf></script></head><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=site-heading><a href=https://conception365.com><h1>Mathias Osterkamp</h1></a><span class=subheading>Specialist â€“ focus development Microsoft technology stack</span></div></div></div></div></header><nav class="navbar navbar-default navbar-custom"><div class=container><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav"><li><a href=/>Home</a></li><li><a href=/categories/administration>administration</a></li><li><a href=/categories/powerapps>powerapps</a></li><li><a href=/categories/spfx>spfx</a></li><li><a href=/top/about/>ABOUT ME</a></li></ul><ul class="nav navbar-nav navbar-right"><li><a href=/search>SEARCH <img src=/img/search.png height=15 style=cursor:pointer alt=Search></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector('.navbar-toggle'),$navbar=document.querySelector('#huxblog_navbar'),$collapse=document.querySelector('.navbar-collapse');$toggle.addEventListener('click',handleMagic);function handleMagic(a){$navbar.className.indexOf('in')>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf('in')<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><article><div class=container><div class=row><div class="col-lg-8
col-md-8
post-container"><div class=post-preview><div class=penci-standard-cat><span class=cat><a class=penci-cat-name href=https://conception365.com/tags/spfx/ rel="category tag">SPFX</a>
<a class=penci-cat-name href=https://conception365.com/tags/sp2019/ rel="category tag">SP2019</a>
<a class=penci-cat-name href=https://conception365.com/tags/pnp/ rel="category tag">PNP</a>
<a class=penci-cat-name href=https://conception365.com/tags/library/ rel="category tag">Library</a></span></div><a href=https://conception365.com/post/2021-03-20-spfx-2019-libraries/><h2 class=post-title>SPFX 2019 Libraries with PnP JS</h2></a><h2 class=post-subtitle>How to create a solution with a library for SharePoint 2019 with some PnP SP inside.</h2><span class=post-meta>Written by
Mathias Osterkamp
on
Saturday, March 20, 2021
and Last Modified on Friday, May 7, 2021</span>
<a href=header.jpg target=_blank><img src=/post/2021-03-20-spfx-2019-libraries/header_hubc7cee928acac53d27edaf34292d924f_5022175_800x0_resize_q75_box.jpg></a></div><h1 id=what-we-create>What we create</h1><p>Ok. Here a small preview, what we like to create in this guide. A sample webpart loading your code from a library, here together with PnP JS to get all site groups.</p><p><a href=webpart-sample.png target=_blank><img src=webpart-sample.png alt="WebPart Sample" loading=lazy></a></p><p>You find the complete source code for the solution <a href=https://github.com/MathiasOsterkamp/spfx-2019-solution>here</a>.</p><h1 id=what-are-spfx-libraries>What are SPFX libraries?</h1><p>If we come to the library topic most people start with the default description from microsoft. (<a href=https://docs.microsoft.com/en-us/sharepoint/dev/spfx/library-component-overview>source</a>)</p><blockquote><p>The library component type in the SharePoint Framework (SPFx) enables you to have independently versioned and deployed code served automatically for the SharePoint Framework components with a deployment through an app catalog. Library components provide you an alternative option to create shared code, which can be then used and referenced cross all the components in the tenant.</p></blockquote><p>Yes i agree all these advantages - I like to start with SharePoint 2019 and use these. What we don&rsquo;t really learn is, nope - you won&rsquo;t get this! Ok after some deep dive i learned a lot and share you some about that. - And of course created a solution.</p><h1 id=library-is-not-library>Library is not library</h1><p>In SharePoint SPFX context the wording library is used a lot, but there are different use cases.</p><h2 id=code-share>Code share</h2><p>First is, we like to put our code into another solution and reuse it between multiple projects. On a code perspective this is relative easy, you can basically create a npm package and share this code by default packaging mechanism with npm. You can find a short description about that <a href=https://n8d.at/tips-and-tricks-working-with-spfx-library-components/>here</a>. But now is our code included inside our main project, so yes it is reused but not shared. We like to build real libraries and also exclude code from our main SPFX files. So we have to continue.</p><h2 id=externals>Externals</h2><p>To exclude code, we can use externals on our SPFX project. We can find some details from Microsoft <a href=https://docs.microsoft.com/en-us/sharepoint/dev/spfx/web-parts/basics/add-an-external-library>here</a></p><blockquote><p>Your client-side solution might include multiple web parts. These web parts might need to import or share the same library. In such cases, instead of bundling the library, you should include it in a separate JavaScript file to improve performance and caching. This is especially true of larger libraries.</p></blockquote><p>This will help us to get our code outside. You will see two methods AMD and non-AMD modules. You find a good description about that on the same article, but it does not help you so much for our specific problem. How we tell sharepoint to build our library code as external?</p><h2 id=library-component>Library component</h2><p>The Library component brings a technical solution. You define a special manifest json with a library component type. Also you define in your config a special bundle with this type.</p><p>config.json</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>    <span style=color:#f1fa8c>&#34;bundles&#34;</span>: {
    <span style=color:#ff79c6>&#34;repository-library&#34;</span>: {
      <span style=color:#ff79c6>&#34;components&#34;</span>: [
        {
          <span style=color:#ff79c6>&#34;entrypoint&#34;</span>: <span style=color:#f1fa8c>&#34;./lib/libraries/repository/RepositoryLibrary.js&#34;</span>,
          <span style=color:#ff79c6>&#34;manifest&#34;</span>: <span style=color:#f1fa8c>&#34;./src/libraries/repository/RepositoryLibrary.manifest.json&#34;</span>
        }
      ]
    }
</code></pre></div><p>RepositoryLibrary.manifest.json</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#ff79c6>&#34;id&#34;</span>: <span style=color:#f1fa8c>&#34;27ce84c6-8b9a-470f-9468-adb991bbb2e9&#34;</span>,
  <span style=color:#ff79c6>&#34;alias&#34;</span>: <span style=color:#f1fa8c>&#34;RepositoryLibrary&#34;</span>,
  <span style=color:#ff79c6>&#34;componentType&#34;</span>: <span style=color:#f1fa8c>&#34;Library&#34;</span>,
  <span style=color:#ff79c6>&#34;version&#34;</span>: <span style=color:#f1fa8c>&#34;*&#34;</span>,
  <span style=color:#ff79c6>&#34;manifestVersion&#34;</span>: <span style=color:#bd93f9>2</span>
}
</code></pre></div><p>Taken from <a href=https://github.com/pnp/sp-dev-fx-library-components/blob/master/samples>sp-dev-fx-library-components</a>.</p><p>Now the concept is, to deploy your component within a SPFX solution and load this inside your actual webpart.</p><p>If we like to use this library component inside SharePoint 2019 OnPremise we will see, yes it builds a solution and yes you could create a correct SPFX solution. But, it will <strong>not</strong> work and nothing happens correct. So i started to look for the reason and the short answer is, it is <strong>just supported from SPFX version 1.8.1</strong> and not available for version 1.4.1.</p><p>You can build your solution, because your webpack compiler understands the type of bundle. Inside webpack is also a configuration called library, what creates a correct bundle. After deploy the solution to SharePoint 2019 AppCatalog it will fail. SharePoint cannot interpret this type correct and there is also missing inside SharePoint 2019 the background technology to load these libraries inside a site page. Technical SharePoint creates a list for all libraries inside the app catalog and loads these libraries if requested. Like it is working with other default Microsoft components.</p><h2 id=custom-libraries>Custom libraries</h2><p>So after this fail with library components, i went back to focus on the external topic and decided to create a separate package loaded by the default externals mechanism. This is working also in older versions of SPFX. The challenge is to allow bundling and get a sweet typescript support.</p><h1 id=how-to-create-a-custom-library>How to create a custom library?</h1><p>We start with separate npm project for our library.</p><p>package.json</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#ff79c6>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;@custom/spfx-2019-lib&#34;</span>,
  <span style=color:#ff79c6>&#34;version&#34;</span>: <span style=color:#f1fa8c>&#34;1.0.0&#34;</span>,
  <span style=color:#ff79c6>&#34;description&#34;</span>: <span style=color:#f1fa8c>&#34;&#34;</span>,
  <span style=color:#ff79c6>&#34;main&#34;</span>: <span style=color:#f1fa8c>&#34;lib/index.js&#34;</span>,
  <span style=color:#ff79c6>&#34;scripts&#34;</span>: {
    <span style=color:#ff79c6>&#34;test&#34;</span>: <span style=color:#f1fa8c>&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span>,
    <span style=color:#ff79c6>&#34;package&#34;</span>: <span style=color:#f1fa8c>&#34;gulp clean  &amp;&amp; tsc -p tsconfig.json &amp;&amp; webpack --config webpack.config.js&#34;</span>
  },
  <span style=color:#ff79c6>&#34;author&#34;</span>: <span style=color:#f1fa8c>&#34;&#34;</span>,
  <span style=color:#ff79c6>&#34;license&#34;</span>: <span style=color:#f1fa8c>&#34;ISC&#34;</span>,
  <span style=color:#ff79c6>&#34;dependencies&#34;</span>: {
    <span style=color:#ff79c6>&#34;@microsoft/sp-application-base&#34;</span>: <span style=color:#f1fa8c>&#34;1.4.1&#34;</span>,
    <span style=color:#ff79c6>&#34;@microsoft/sp-core-library&#34;</span>: <span style=color:#f1fa8c>&#34;1.4.1&#34;</span>,
    <span style=color:#ff79c6>&#34;@microsoft/sp-webpart-base&#34;</span>: <span style=color:#f1fa8c>&#34;1.4.1&#34;</span>,
    <span style=color:#ff79c6>&#34;@pnp/sp&#34;</span>: <span style=color:#f1fa8c>&#34;2.0.13&#34;</span>
  },
  <span style=color:#ff79c6>&#34;devDependencies&#34;</span>: {
    <span style=color:#ff79c6>&#34;@types/es6-promise&#34;</span>: <span style=color:#f1fa8c>&#34;0.0.33&#34;</span>,
    <span style=color:#ff79c6>&#34;@types/microsoft-ajax&#34;</span>: <span style=color:#f1fa8c>&#34;0.0.33&#34;</span>,
    <span style=color:#ff79c6>&#34;@types/sharepoint&#34;</span>: <span style=color:#f1fa8c>&#34;2016.1.2&#34;</span>,
    <span style=color:#ff79c6>&#34;@types/webpack-env&#34;</span>: <span style=color:#f1fa8c>&#34;1.14.1&#34;</span>,
    <span style=color:#ff79c6>&#34;del&#34;</span>: <span style=color:#f1fa8c>&#34;5.1.0&#34;</span>,
    <span style=color:#ff79c6>&#34;gulp&#34;</span>: <span style=color:#f1fa8c>&#34;^3.9.1&#34;</span>,
    <span style=color:#ff79c6>&#34;webpack&#34;</span>: <span style=color:#f1fa8c>&#34;4.42.0&#34;</span>,
    <span style=color:#ff79c6>&#34;webpack-cli&#34;</span>: <span style=color:#f1fa8c>&#34;^3.3.11&#34;</span>,
    <span style=color:#ff79c6>&#34;fork-ts-checker-webpack-plugin&#34;</span>: <span style=color:#f1fa8c>&#34;4.1.0&#34;</span>,
    <span style=color:#ff79c6>&#34;typescript&#34;</span>: <span style=color:#f1fa8c>&#34;3.6.4&#34;</span>
  }
}

</code></pre></div><p>We define a name <strong>@custom/spfx-2019-lib</strong> and add our dependencies. Furthermore we create a custom webpack to create a smart bundle.</p><p>webpack.config.json (not full version)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>const path = require(&#39;path&#39;);
const del = require(&#39;del&#39;);
const ForkTsCheckerWebpackPlugin = require(&#39;fork-ts-checker-webpack-plugin&#39;);
const webpack = require(&#39;webpack&#39;);

var PACKAGE = require(&#39;./package.json&#39;);
var version = PACKAGE.version.replace(/\./g, &#39;_&#39;);

...

module.exports = [&#39;source-map&#39;].map((devtool) =&gt; ({
  mode: &#39;development&#39;,
  entry: {
    <span style=color:#ff79c6>&#34;spfx2019lib&#34;</span>: &#39;./lib/index.js&#39;
  },
  resolve: {
    extensions: [&#39;.ts&#39;, &#39;.tsx&#39;, &#39;.js&#39;],
    modules: [&#39;node_modules&#39;]
  },
  context: path.resolve(__dirname),
  output: {
    path: path.resolve(__dirname, &#39;dist&#39;),
    chunkFilename: &#39;[id].[name]_[chunkhash].js&#39;,
    filename: &#39;[name].js&#39;,
    library: &#39;[name]_&#39; + version,
    libraryTarget: &#39;var&#39;,
    umdNamedDefine: true,
    devtoolModuleFilenameTemplate: &#39;webpack:///../[resource-path]&#39;,
    devtoolFallbackModuleFilenameTemplate: &#39;webpack:///../[resource-path]?[hash]&#39;
  },
  devtool,
  optimization: {
    runtimeChunk: false
  },
  performance: { hints: false },
  externals: [
    &#39;@microsoft/decorators&#39;,
    &#39;@microsoft/sp-lodash-subset&#39;,
    &#39;@microsoft/sp-core-library&#39;,
    &#39;@microsoft/office-ui-fabric-react-bundle&#39;,
    &#39;@microsoft/sp-polyfills&#39;,
    &#39;@microsoft/sp-loader&#39;,
    &#39;@microsoft/sp-http&#39;,
    &#39;@microsoft/sp-page-context&#39;,
    &#39;@microsoft/sp-component-base&#39;,
    &#39;@microsoft/sp-extension-base&#39;,
    &#39;@microsoft/sp-application-base&#39;,
    &#39;@microsoft/sp-webpart-base&#39;,
    &#39;@microsoft/sp-dialog&#39;,
    &#39;@microsoft/sp-office-ui-fabric-core&#39;,
    &#39;@microsoft/sp-client-preview&#39;,
    &#39;@microsoft/sp-webpart-workbench&#39;
  ],
  module: {
  ...
  },
  plugins: [
    new webpack.optimize.LimitChunkCountPlugin({
      maxChunks: 1
    }),
    new ForkTsCheckerWebpackPlugin({
      tslint: false
    }),
    new ClearCssModuleDefinitionsPlugin(),
    new webpack.DefinePlugin({
      &#39;process.env.NODE_ENV&#39;: JSON.stringify(process.env.NODE_ENV),
      &#39;process.env.DEBUG&#39;: JSON.stringify(true),
      DEBUG: JSON.stringify(true)
    })
  ]
}));

</code></pre></div><p>The most important thing is the filename:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#f1fa8c>&#34;spfx2019lib&#34;</span>: &#39;./lib/index.js&#39;
</code></pre></div><p>And our library target, it is an old UMD module. So we package everything into a variable.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>libraryTarget: &#39;var&#39;,
umdNamedDefine: <span style=color:#ff79c6>true</span>,
</code></pre></div><p>I tried to use newer AMD module definition, but again SharePoint 2019 cannot handle this correct. It was a problem with loading the modules inside application extensions, here it was breaking. For old UMD modules, everything works correct.</p><p>I implemented also a small service inside the solution, working with latest PnP version.</p><p>PnPService.ts</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#ff79c6>import</span> { sp } <span style=color:#ff79c6>from</span> <span style=color:#f1fa8c>&#34;@pnp/sp&#34;</span>;
<span style=color:#ff79c6>import</span> <span style=color:#f1fa8c>&#34;@pnp/sp/webs&#34;</span>;
<span style=color:#ff79c6>import</span> <span style=color:#f1fa8c>&#34;@pnp/sp/site-groups&#34;</span>;
<span style=color:#ff79c6>import</span> { ISiteGroupInfo } <span style=color:#ff79c6>from</span> <span style=color:#f1fa8c>&#34;../interfaces/models/ISiteGroupInfo&#34;</span>;
<span style=color:#ff79c6>import</span> { IPnPService } <span style=color:#ff79c6>from</span> <span style=color:#f1fa8c>&#34;../interfaces/IPnPService&#34;</span>;

<span style=color:#ff79c6>export</span> <span style=color:#ff79c6>class</span> PnPService  <span style=color:#ff79c6>implements</span> IPnPService {
  
 <span style=color:#ff79c6>constructor</span>(absoluteWebUrl:<span style=color:#8be9fd>string</span>){
  sp.setup({
    sp<span style=color:#ff79c6>:</span> {
      baseUrl: <span style=color:#8be9fd>absoluteWebUrl</span>
    }
  });
 }
  <span style=color:#6272a4>/**
</span><span style=color:#6272a4>   * Get all site groups
</span><span style=color:#6272a4>   */</span>
  <span style=color:#ff79c6>public</span> <span style=color:#ff79c6>async</span> getAllSiteGroups()<span style=color:#ff79c6>:</span> Promise&lt;<span style=color:#ff79c6>ISiteGroupInfo</span>[]&gt; {
    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>await</span> sp.web.siteGroups.<span style=color:#ff79c6>get</span>() <span style=color:#ff79c6>as</span> ISiteGroupInfo[];
  }
}
</code></pre></div><p>One important thing is, to use own interfaces and also export everything on the index.ts. Your package also links to this file <strong>&ldquo;main&rdquo;: &ldquo;lib/index.js&rdquo;</strong>.</p><p>index.ts</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#ff79c6>export</span> <span style=color:#ff79c6>*</span> <span style=color:#ff79c6>from</span> <span style=color:#f1fa8c>&#39;./interfaces&#39;</span>;
<span style=color:#ff79c6>export</span> <span style=color:#ff79c6>*</span> <span style=color:#ff79c6>from</span> <span style=color:#f1fa8c>&#39;./services&#39;</span>;
</code></pre></div><p>Now you will get a correct library</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd>npm run package

&gt; @custom/spfx-2019-lib@1.0.0 package C:\daten\git\spfx-2019-solution\spfx-2019-lib
&gt; gulp clean  &amp;&amp; tsc -p tsconfig.json &amp;&amp; webpack --config webpack.config.js

[17:02:31] Using gulpfile C:\daten\git\spfx-2019-solution\spfx-2019-lib\gulpfile.js
[17:02:31] Starting &#39;clean&#39;...
[17:02:31] Finished &#39;clean&#39; after 76 ms
Starting type checking service...
Hash: abe77e4dd0d7cd747042
Version: webpack 4.42.0
Child
    Hash: abe77e4dd0d7cd747042
    <span style=color:#ff79c6>Time</span>: 2930ms
    Built at: 2021-05-07 5:02:42 PM
                 Asset     Size       Chunks                          Chunk Names
        spfx2019lib.js  334 KiB  spfx2019lib  [emitted]        [big]  spfx2019lib
    spfx2019lib.js.map  286 KiB  spfx2019lib  [emitted] [dev]         spfx2019lib
    Entrypoint spfx2019lib [big] = spfx2019lib.js spfx2019lib.js.map
    [./lib/index.js] 62 bytes {spfx2019lib} [built]
    [./lib/services/PnPService.js] 3.27 KiB {spfx2019lib} [built]
    [./lib/services/index.js] 64 bytes {spfx2019lib} [built]
    [./node_modules/webpack/buildin/global.js] (webpack)/buildin/global.js 472 bytes {spfx2019lib} [built]
        + 53 hidden modules

</code></pre></div><h1 id=include-this-into-your-project>Include this into your project</h1><h2 id=general>General</h2><p>Now we reuse or library inside our other project, we create a symlink by just adding this to your package configuration.</p><p>package.json</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>  <span style=color:#f1fa8c>&#34;dependencies&#34;</span>: {
    <span style=color:#ff79c6>&#34;@custom/spfx-2019-lib&#34;</span>: <span style=color:#f1fa8c>&#34;file:../spfx-2019-lib&#34;</span>,
    ...
  },
</code></pre></div><p>Inside our config we declare to use this project as external. The global name is defined inside your library project. The bundle mechanism will exclude all code into a separate file.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json> <span style=color:#f1fa8c>&#34;externals&#34;</span>: {
    <span style=color:#ff79c6>&#34;@custom/spfx-2019-lib&#34;</span>: {
      <span style=color:#ff79c6>&#34;path&#34;</span>: <span style=color:#f1fa8c>&#34;./node_modules/@custom/spfx-2019-lib/dist/spfx2019lib.js&#34;</span>,
      <span style=color:#ff79c6>&#34;globalName&#34;</span>: <span style=color:#f1fa8c>&#34;spfx2019lib_1_0_0&#34;</span>
  }
</code></pre></div><p>Now we can use this library inside your webpart. It is important just use the package name <strong>"@custom/spfx-2019-lib"</strong> and NO subpath (lib/&mldr;). Only code with exact package name will excluded into separate file.</p><p>HelloWorld.tsx</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#ff79c6>import</span> { ISiteGroupInfo, PnPService } <span style=color:#ff79c6>from</span> <span style=color:#f1fa8c>&#34;@custom/spfx-2019-lib&#34;</span>;
...
<span style=color:#ff79c6>public</span> <span style=color:#ff79c6>async</span> componentDidMount()<span style=color:#ff79c6>:</span> Promise&lt;<span style=color:#ff79c6>void</span>&gt; {
    <span style=color:#ff79c6>const</span> service <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> PnPService(<span style=color:#ff79c6>this</span>.props.absoluteWebUrl);
    <span style=color:#8be9fd;font-style:italic>let</span> groups <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>await</span> service.getAllSiteGroups();
    <span style=color:#ff79c6>this</span>.setState({ groups: <span style=color:#8be9fd>groups</span> });
}
</code></pre></div><h1 id=pnp-specific>PnP Specific</h1><p>For our PnP stuff we have to tell our compiler to use latest typescript. This is done in our gulp file.</p><p>gulpfile.js</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#ff79c6>const</span> typeScriptConfig <span style=color:#ff79c6>=</span> require(<span style=color:#f1fa8c>&#39;@microsoft/gulp-core-build-typescript/lib/TypeScriptConfiguration&#39;</span>);
typeScriptConfig.TypeScriptConfiguration.setTypescriptCompiler(require(<span style=color:#f1fa8c>&#39;typescript&#39;</span>));

<span style=color:#ff79c6>const</span> buildtypescript <span style=color:#ff79c6>=</span> require(<span style=color:#f1fa8c>&#39;@microsoft/gulp-core-build-typescript&#39;</span>);
buildtypescript.tslint.enabled <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>false</span>;
</code></pre></div><p>PnP js has also a problem with source map typings, we disable this in our build configuration.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#8be9fd;font-style:italic>function</span> includeRuleForSourceMapLoader(rules) {
    <span style=color:#ff79c6>for</span> (<span style=color:#ff79c6>const</span> rule <span style=color:#ff79c6>of</span> rules) {
      <span style=color:#ff79c6>if</span> (rule.use <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#ff79c6>typeof</span> rule.use <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#39;string&#39;</span> <span style=color:#ff79c6>&amp;&amp;</span> rule.use.indexOf(<span style=color:#f1fa8c>&#39;source-map-loader&#39;</span>) <span style=color:#ff79c6>!==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) {
        rule.include <span style=color:#ff79c6>=</span> [path.resolve(<span style=color:#bd93f9>__</span>dirname, <span style=color:#f1fa8c>&#39;lib&#39;</span>), path.resolve(<span style=color:#bd93f9>__</span>dirname, <span style=color:#f1fa8c>&#39;node_modules&#39;</span>, <span style=color:#f1fa8c>&#39;spfx-2019-lib&#39;</span>)];
      }
    }
}
build.configureWebpack.mergeConfig({
  additionalConfiguration<span style=color:#ff79c6>:</span> (generatedConfiguration) =&gt; {
    <span style=color:#6272a4>//we dont like to include all source maps
</span><span style=color:#6272a4></span>    includeRuleForSourceMapLoader(generatedConfiguration.module.rules);
    <span style=color:#ff79c6>return</span> generatedConfiguration;
  }
});
</code></pre></div><h2 id=run-it>Run it</h2><p>You can run it and build your spfx solution.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd>PS C:\daten\git\spfx-2019-solution\spfx-2019&gt; npm run package-ship

&gt; spfx-2019@0.0.1 package-ship C:\daten\git\spfx-2019-solution\spfx-2019        
&gt; gulp clean &amp;&amp; gulp build &amp;&amp; gulp bundle --ship &amp;&amp; gulp package-solution --ship
...
[17:22:57] Finished subtask &#39;package-solution&#39; after 1.09 s
[17:22:57] Finished &#39;package-solution&#39; after 1.14 s
[17:22:57] ==================[ Finished ]==================
[17:22:58] Project spfx-2019 version: 0.0.1
[17:22:58] Build tools version: 3.2.7
[17:22:58] Node version: v10.22.0
[17:22:58] Total duration: 8.09 s
</code></pre></div><p>You can see our library inside the manifests.json (located in the temp folder).</p><p>manifests.json</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json> <span style=color:#f1fa8c>&#34;loaderConfig&#34;</span>: {
    <span style=color:#ff79c6>&#34;entryModuleId&#34;</span>: <span style=color:#f1fa8c>&#34;hello-world-web-part&#34;</span>,
    <span style=color:#ff79c6>&#34;internalModuleBaseUrls&#34;</span>: [
    <span style=color:#f1fa8c>&#34;https://localhost:4321/&#34;</span>
    ],
    <span style=color:#ff79c6>&#34;scriptResources&#34;</span>: {
    <span style=color:#ff79c6>&#34;hello-world-web-part&#34;</span>: {
        <span style=color:#ff79c6>&#34;type&#34;</span>: <span style=color:#f1fa8c>&#34;path&#34;</span>,
        <span style=color:#ff79c6>&#34;path&#34;</span>: <span style=color:#f1fa8c>&#34;dist/hello-world-web-part.js&#34;</span>
    },
    <span style=color:#ff79c6>&#34;@custom/spfx-2019-lib&#34;</span>: {
        <span style=color:#ff79c6>&#34;type&#34;</span>: <span style=color:#f1fa8c>&#34;path&#34;</span>,
        <span style=color:#ff79c6>&#34;path&#34;</span>: <span style=color:#f1fa8c>&#34;node_modules/@custom/spfx-2019-lib/dist/spfx2019lib.js&#34;</span>,
        <span style=color:#ff79c6>&#34;globalName&#34;</span>: <span style=color:#f1fa8c>&#34;spfx2019lib_1_0_0&#34;</span>
    },
</code></pre></div><p>Now we deploy our solution and if we check our webpart we have excluded our code inside a single file @custom-spfx-2019-lib_f61c3320dcfac71474b84527be597369.js. It will also work with multiple webparts.</p><p><a href=loaded-resources.png target=_blank><img src=loaded-resources.png alt=Recourses loading=lazy></a></p><p>Finally we get to run our smart webpart with PnP.
<a href=webpart-sample.png target=_blank><img src=webpart-sample.png alt="WebPart Sample" loading=lazy></a></p><h1 id=conclusion>Conclusion</h1><p>I hope this approach helps you to create better SPFX 2013 solutions and externalize your code in your own libraries. Here some small hints.</p><p>Good:</p><ul><li><input checked disabled type=checkbox> The code can shared between multiple webparts inside a solution</li><li><input checked disabled type=checkbox> You have full support of typings</li><li><input checked disabled type=checkbox> You can use other libraries inside your library (like PnP JS)</li><li><input checked disabled type=checkbox> You don&rsquo;t have to care about versioning, it is still bundled inside your package</li><li><input checked disabled type=checkbox> You can share your library with other projects</li></ul><p>Bad:</p><ul><li><input disabled type=checkbox> You can not externalize React this way! Another story.</li><li><input disabled type=checkbox> Don&rsquo;t externalize Office-Fabric-UI this way, similar to React.</li><li><input disabled type=checkbox> You cannot use other microsoft libraries inside your library (example @microsoft/sp-page-context)! The problem is, that the module loader can not load related sub libraries.</li></ul><div class=post-author><div class=author-img><img alt="Mathias Osterkamp" src=https://conception365.com/img/mathiasosterkamp_half.png class="avatar avatar-100 photo" height=100 width=100></div><div class=author-content><h5><a href=/top/about/ title="Written by Mathias Osterkamp" rel=author>Mathias Osterkamp</a></h5><p>I've been working for about 12 years with a thematic focus on 'Collaboration' and 'Digital Transformation' especially in the product environment Microsoft on the topics Office 365, SharePoint, Azure and general web development.</p></div></div><ul class=pager><li class=previous><a href=https://conception365.com/post/2021-02-11-orphaned-terms/ data-toggle=tooltip data-placement=top title="Remove Managed Metadata Orphaned Terms">&larr;
Previous Post<div class=pager-title>Remove Managed Metadata Orphaned Terms</div></a></li><li class=next><a href=https://conception365.com/post/2021-04-22-spfx-2019-prettier-eslint/ data-toggle=tooltip data-placement=top title="SPFX 2019 eslint and prettier">Next
Post &rarr;<div class=pager-title>SPFX 2019 eslint and prettier</div></a></li></ul><br></div><div class="col-lg-4
col-md-4
sidebar-container"><h5>TOC</h5><nav id=TableOfContents><ul><li><a href=#what-we-create>What we create</a></li><li><a href=#what-are-spfx-libraries>What are SPFX libraries?</a></li><li><a href=#library-is-not-library>Library is not library</a><ul><li><a href=#code-share>Code share</a></li><li><a href=#externals>Externals</a></li><li><a href=#library-component>Library component</a></li><li><a href=#custom-libraries>Custom libraries</a></li></ul></li><li><a href=#how-to-create-a-custom-library>How to create a custom library?</a></li><li><a href=#include-this-into-your-project>Include this into your project</a><ul><li><a href=#general>General</a></li></ul></li><li><a href=#pnp-specific>PnP Specific</a><ul><li><a href=#run-it>Run it</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/tags/managed-metadata title=managed-metadata>managed-metadata</a>
<a href=/tags/onpremise title=onpremise>onpremise</a>
<a href=/tags/pnp title=pnp>pnp</a>
<a href=/tags/powerapps title=powerapps>powerapps</a>
<a href=/tags/powershell title=powershell>powershell</a>
<a href=/tags/sevdesk title=sevdesk>sevdesk</a>
<a href=/tags/sharepoint title=sharepoint>sharepoint</a>
<a href=/tags/sp2019 title=sp2019>sp2019</a>
<a href=/tags/spfx title=spfx>spfx</a></div></section><section><hr><h5>RECENT POSTS</h5><ul class=side-newsfeed><li class=penci-feed><div class=side-item><div class=side-image><a class="penci-image-holder penci-lazy small-fix-size" rel=bookmark href=https://conception365.com/post/2024-01-28-pnp-powwershell-2019-onpremise-docs/ title="PnP Powershell 2019 Documentation" style=display:inline-block;background-image:url(/post/2024-01-28-pnp-powwershell-2019-onpremise-docs/header_hub75b70aca03219830cc5b11ef9adcf02_2046261_120x0_resize_box_2.png)></a></div><div class=side-item-text><h4 class=side-title-post><a href=https://conception365.com/post/2024-01-28-pnp-powwershell-2019-onpremise-docs/ rel=bookmark title="PnP Powershell 2019 Documentation">PnP Powershell 2019 Documentation</a></h4><span class=side-item-meta><time class="entry-date published">Sunday, January 28, 2024</time></span></div></div></li><li class=penci-feed><div class=side-item><div class=side-image><a class="penci-image-holder penci-lazy small-fix-size" rel=bookmark href=https://conception365.com/post/2022-01-30-mysite-redirect-links/ title="Mysite - Redirects" style=display:inline-block;background-image:url(/post/2022-01-30-mysite-redirect-links/header_hu1fc9044e0354cb91afb2b35d3c05b456_3585475_120x0_resize_box_2.png)></a></div><div class=side-item-text><h4 class=side-title-post><a href=https://conception365.com/post/2022-01-30-mysite-redirect-links/ rel=bookmark title="Mysite - Redirects">Mysite - Redirects</a></h4><span class=side-item-meta><time class="entry-date published">Sunday, January 30, 2022</time></span></div></div></li><li class=penci-feed><div class=side-item><div class=side-image><a class="penci-image-holder penci-lazy small-fix-size" rel=bookmark href=https://conception365.com/post/2021-11-01-powershell-create-navigation/ title="Powershell - Create Navigation" style=display:inline-block;background-image:url(/post/2021-11-01-powershell-create-navigation/header_hu57fad8182e36ba611e1f4a15b5e0c725_73932_120x0_resize_box_2.png)></a></div><div class=side-item-text><h4 class=side-title-post><a href=https://conception365.com/post/2021-11-01-powershell-create-navigation/ rel=bookmark title="Powershell - Create Navigation">Powershell - Create Navigation</a></h4><span class=side-item-meta><time class="entry-date published">Monday, November 1, 2021</time></span></div></div></li><li class=penci-feed><div class=side-item><div class=side-image><a class="penci-image-holder penci-lazy small-fix-size" rel=bookmark href=https://conception365.com/post/2021-10-22-jsom-termgroup-add-contributor/ title="Site termgroup add contributor or manager" style=display:inline-block;background-image:url(/post/2021-10-22-jsom-termgroup-add-contributor/header_huf4a0530713166702484ca9ce582083fb_54113_120x0_resize_box_2.png)></a></div><div class=side-item-text><h4 class=side-title-post><a href=https://conception365.com/post/2021-10-22-jsom-termgroup-add-contributor/ rel=bookmark title="Site termgroup add contributor or manager">Site termgroup add contributor or manager</a></h4><span class=side-item-meta><time class="entry-date published">Friday, October 22, 2021</time></span></div></div></li><li class=penci-feed><div class=side-item><div class=side-image><a class="penci-image-holder penci-lazy small-fix-size" rel=bookmark href=https://conception365.com/post/2021-08-31-spfx-showcase-mysite/ title="SPFX Showcase - MySite" style=display:inline-block;background-image:url(/post/2021-08-31-spfx-showcase-mysite/header_hu08cc3da8430171f206449dcc5b7e02bb_59082_120x0_resize_box_2.png)></a></div><div class=side-item-text><h4 class=side-title-post><a href=https://conception365.com/post/2021-08-31-spfx-showcase-mysite/ rel=bookmark title="SPFX Showcase - MySite">SPFX Showcase - MySite</a></h4><span class=side-item-meta><time class="entry-date published">Tuesday, August 31, 2021</time></span></div></div></li></ul></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href rel=alternate type=application/rss+xml title="Mathias Osterkamp"><span class=fa-stack><i class="fas fa-rss"></i></span>
RSS</a></li><li><a href=mailto:mathias.osterkamp@conception365.com><span class=fa-stack><i class="fas fa-envelope"></i></span>
Email</a></li><li><a href=/top/impressum/><span>Impressum</span></a></li><li><a href=/top/privacy/><span>Privacy Policy</span></a></li></ul><p class="copyright text-muted">Copyright &copy; Mathias Osterkamp 2024</p></div></div></div></footer></body></html>